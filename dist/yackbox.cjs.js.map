{"version":3,"file":"yackbox.cjs.js","sources":["../src/yackbox.js"],"sourcesContent":["export default class yackbox {\n    /**\n    *\n    @param {(string|HTMLElement)} div - A string representing the CSS selector of the container element, or an HTMLElement object representing the container element itself.\n    @param {Function} completionCallback - A callback function that will be invoked when the user submits a message. This function will receive an object containing the user's message and username, and two callback functions: one for adding a new message to the chat, and another for appending content to an existing message.\n    @param {Function} streamCallback - A callback function that will be invoked when a streaming message is received. This function will receive an object containing the message content and the ID of the message to update.\n    */\n    constructor(div, completionCallback, streamCallback) {\n        this.container = (typeof (div) == \"string\") ? document.querySelector(div) : (div instanceof HTMLElement) ? div : null;\n        if (!this.container) {\n            console.error(\"Invalid container element for yackbox, creating a new element.\");\n            this.container = document.createElement('div');\n        }\n        // title\n        this.title = \"Chat\";\n        this.titleAlignment = \"center\";\n\n        // user add\n        this.userName = \"You\";\n        this.userAlignment = \"left\";\n\n        // callback functions\n        this.completionCallback = (completionCallback) ? completionCallback : () => { };\n        this.streamCallback = (streamCallback) ? streamCallback : () => { };\n\n        // history\n        this.messages = [];\n        this.echo = true; // echo user input\n        this.users = {}\n        // this.users = {}\n        this.initUI();\n    }\n    /**\n    *\n    @param {Function} completionCallback - A callback function that will be invoked when the user submits a message. This function will receive an object containing the user's message and username, and two callback functions: one for adding a new message to the chat, and another for appending content to an existing message.\n    */\n    addCompletionCallback(completionCallback) {\n        this.completionCallback = (completionCallback) ? completionCallback : () => { };\n    }\n    /**\n    *\n    @param {Function} streamCallback - A callback function that will be invoked when a streaming message is received. This function will receive an object containing the message content and the ID of the message to update.\n    */\n    addStreamCallback(streamCallback) {\n        this.streamCallback = (streamCallback) ? streamCallback : () => { };\n    }\n    /**\n    Adds a message from the current user to the chat.\n    @param {string} content - The content of the message.\n    */\n    addUserMessage(content) {\n        this.addMessage(content, this.userName, this.userAlignment);\n    }\n    /**\n    Sets the default username and alignment for user messages.\n    @param {string} user - The username to use for user messages. Defaults to \"You\".\n    @param {string} alignment - The alignment of user messages. Can be \"left\", \"right\", or \"center\". Defaults to \"right\".\n    */\n    setDefaultUserName(user = \"You\", alignment = \"right\") {\n        this.userName = user;\n        this.userAlignement = alignment;\n    }\n    /**\n    Sets whether or not to echo the user's input back to the chat.\n    @param {boolean} echo - True to echo the user's input, false otherwise.\n    @returns {boolean} The current echo setting.\n    */\n    setUserInputEcho(echo) {\n        this.echo = (echo) ? true : false;\n        return this.echo;\n    }\n\n    /**\n     * Adjusts the height of the messages area to fit the chat widget.\n     * This method should be called whenever the chat widget is resized.\n     */\n    adjustMessagesAreaHeight() {\n        const chatWidget = this.container;\n        const hiddenElements = [...chatWidget.children].filter(child => child.classList.contains('hidden'));\n        const totalHiddenHeight = hiddenElements.reduce((sum, child) => sum + child.offsetHeight, 0);\n        const containerHeight = chatWidget.offsetHeight;\n        this.messagesContainer.style.height = `calc(100% - ${containerHeight - totalHiddenHeight}px)`;\n    }\n  \n    handleContainerResize() {\n        adjustMessagesAreaHeight();\n        adjustSendButtonWidth();\n    }\n\n    adjustSendButtonWidth() {\n        const submitButtonText = this.submitButton.textContent.trim();\n        const fontSize = parseFloat(getComputedStyle(this.submitButton).fontSize);\n        const minWidth = fontSize * submitButtonText.length + 16; // Adjust the multiplier as needed\n        this.submitButton.style.minWidth = `${minWidth}px`;\n    }\n\n\n\n\n    /**\n    Shows or hides the input area of the chat.\n    @param {boolean} show - True to show the input area, false to hide it.\n    */\n    showInputArea(show) {\n        if (show) {\n            this.inputAreaBox.style.display = \"flex\";\n            this.inputAreaBox.classList.remove('hidden');\n        }\n        else {\n            this.inputAreaBox.style.display = \"none\";\n            this.inputAreaBox.classList.add('hidden');\n        }\n        this.adjustMessagesAreaHeight();\n    }\n\n    showTitleArea(show) {\n        if (show) {\n            this.titleArea.style.display = \"flex\";\n            this.titleArea.classList.remove('hidden');\n        }\n        else {\n            this.titleArea.style.display = \"none\";\n            this.titleArea.classList.add('hidden');\n        }\n        this.adjustMessagesAreaHeight();\n    }\n\n    /**\n    Adds a new message to the chat.\n    @param {string} content - The content of the message.\n    @param {string} user - The username of the sender.\n    @param {string} alignment - The alignment of the message. Can be \"left\", \"right\", or \"center\". Defaults to \"left\".\n    @returns {number} The ID of the newly added message.\n    */\n    // add a new message to the chat\n    addMessage(content, user, alignment = 'left') {\n        const id = this.messages.length;\n        const timestamp = (new Date()).toUTCString();\n        const message = { id, user, content, alignment, timestamp };\n        this.messages.push(message);\n        const lcr = (alignment == \"left\") ? \"yackbox-left\" : (alignment == \"right\") ? \"yackbox-right\" : \"yackbox-center\";\n        const userContent = `<div class=\"yackbox-username ${lcr}\">${user}</div>`;\n        const messageContent = `<div class=\"yackbox-content ${lcr}\">${content}</div>`;\n        const messageHTML = `<div id=\"yackbox-msg-${id}\" class=\"yackbox-message ${lcr}\">${userContent}${messageContent}</div>`;\n        this.messagesContainer.innerHTML += messageHTML;\n        this.messagesContainer.lastChild.scrollIntoView()\n        return id;\n    }\n    /**\n    Updates all the fields of an existing message.\n    @param {number} id - The ID of the message to update.\n    @param {string} content - The new content of the message.\n    @param {string} user - The new username of the sender.\n    @param {string} side - The new alignment of the message. Can be \"left\", \"right\", or \"center\".\n    @returns {number} The ID of the updated message, or undefined if the message was not found.\n    */\n    // update all the fields of an existing message\n    updateMessageFull(id, content, user = null, side = null) {\n        const message = this.messages.find(msg => msg.id === id);\n        if (!message) return;\n        if (content) message.content = content;\n        if (user) message.user = user;\n        if (side) message.whichSide = side;\n        message.lastUpdateTimestamp = (new Date()).toUTCString();\n        const messageDiv = this.container.querySelector(\"#msg - ${id}\");\n        if (messageDiv) {\n            const userContent = `<div class=\"yackbox-username\">${message.user}</div>`;\n            const messageContent = `<div class=\"yackbox-content\">${message.content}</div>`;\n            messageDiv.innerHTML = `${messageContent}${userContent}`;\n        }\n        return id;\n    }\n    /**\n    Appends content to an existing message, useful for streaming.\n    @param {number} id - The ID of the message to update.\n    @param {string} content - The content to append to the message.\n    @returns {number} The ID of the updated message, or undefined if the message was not found.\n    */\n    // append content to an existing message, useful for streaming\n    appendMessageContent(id, content) {\n        const message = this.messages.find(msg => msg.id === id);\n        if (!message) return;\n        if (content)\n            message.content += content;\n        message.lastUpdateTimestamp = (new Date()).toUTCString();\n        const messageDiv = this.container.querySelector(`#yackbox-msg-${id} .yackbox-content`);\n        if (messageDiv) {\n            messageDiv.innerHTML = message.content;\n            messageDiv.scrollIntoView(false);\n        }\n        return id;\n    }\n    /**\n    Removes a single message.\n    @param {number} id - The ID of the message to remove.\n    @returns {boolean} True if the message was removed, false otherwise.\n    */\n    // remove a single message\n    removeMessage(id) {\n        const messageIndex = this.messages.findIndex(msg => msg.id === id);\n        if (messageIndex > -1) {\n            this.messages.splice(messageIndex, 1);\n            const messageDiv = this.container.querySelector(\".yackbox-msg${id}\");\n            if (messageDiv) {\n                messageDiv.parentNode.removeChild(messageDiv);\n            }\n            return true;\n        }\n        return false; // didn't do anything\n    }\n    /**\n    Removes all messages from the chat.\n    */\n    //remove all messages\n    removeMessageAll() {\n        this.messages = [];\n    }\n    /**\n    Initializes the UI elements of the chat.\n    */\n    initUI() {\n        this.container.innerHTML = \n        `<div class=\"yackbox-base yackbox-theme-light\"> \n            <div class=\"yackbox-title-area\"></div>\n            <div class=\"yackbox-messages-area\"></div> \n            <div class=\"yackbox-input-area\"> \n                <textarea class=\"yackbox-input-textbox\" placeholder=\"Type here...\"></textarea> \n                <button class=\"yackbox-input-send-btn\">Send</button>\n            </div>\n        </div>`;\n\n        // in-line styles : Note these settings are just for making the basic plumbing work and \n        // are not part of styling the chatbox.  The chatbox is styled using the yackbox.css file\n        /*\n        this.baseStyles = {\n            \"yackbox-base\": {\n                \"display\": \"flex\",\n                \"flex-direction\": \"column\",\n                \"height\": \"100%\",\n                \"width\": \"100%\",\n                \"min-width\": \"200px\",\n                \"min-height\": \"200px\",\n            },\n            \"yackbox-title-area\": {\n                \"width\": \"100%\",\n                \"padding-left\": \"8px\",\n                \"padding-right\": \"8px\",\n            },\n\n            \"yackbox-messages-area\": {\n                \"flex-grow\": \"1\",\n                \"padding\": \"8px\",\n                \"overflow-y\": \"auto\",\n                \"width\": \"100%\",\n            },\n\n            \"yackbox-message\": {\n                \"padding\": \"2px\"\n            },\n\n            \"yackbox-input-area\": {\n                \"display\": \"flex\",\n                \"align-items\": \"center\",\n                \"padding\": \"8px\",\n                \"min-height\": \"56px\",\n                \"height\": \"4em\",\n                \"width\": \"100%\"\n            },\n            \"yackbox-input-textbox\": {\n                \"flex-grow\": \"1\",\n                \"min-height\": \"40px\",\n                \"resize\": \"none\",\n                \"padding\": \"8px\"\n            },\n            \"yackbox-input-send-btn\": {\n                \"margin-left\": \"8px\",\n                \"padding\": \"8px 12px\",\n                \"height\": \"100%\",\n                \"cursor\": \"pointer\",\n                \"white-space\": \"nowrap\"\n            }\n        }\n        */\n        let setStyles = (el, styles) => {\n            for (let s in styles) {\n                el.style[s] = styles[s];\n            }\n        }\n        this.yackboxContainer = this.container.querySelector('.yackbox-base');\n        this.titleArea = this.container.querySelector('.yackbox-title-area');\n        this.titleArea.innerHTML = \"<h3>\" +this.title+\"</h3>\";\n       \n        //setStyles (this.titleArea, this.baseStyles[\"yackbox-title-area\"]);\n\n        this.messagesContainer = this.container.querySelector('.yackbox-messages-area');\n        //setStyles(this.messagesContainer, this.baseStyles[\"yackbox-messages-area\"]);\n\n        this.messagesContainer.scrollIntoView(false);\n        this.inputAreaBox = this.container.querySelector('.yackbox-input-area');\n        //setStyles(this.inputAreaBox, this.baseStyles[\"yackbox-input-area\"]);\n\n        this.inputTextArea = this.container.querySelector('.yackbox-input-textbox');\n        //setStyles(this.inputTextArea, this.baseStyles[\"yackbox-input-textbox\"]);\n\n        this.submitButton = this.container.querySelector('.yackbox-input-send-btn');\n        //setStyles(this.submitButton, this.baseStyles[\"yackbox-input-send-btn\"]);\n\n        // now we add the base styles for the chat container and sub elements\n        // set base styles for the chat container.  NOTE this is done in js so that we can have \n        // multiple instances of the chatbox on the same page with different styles\n        // see yaclbox.css for the default styles\n\n\n\n        //===================================================================================\n        // Add event listener to the chat input textarea\n        const inputTextarea = this.inputTextArea;\n        // memoize callback fn\n        let admsg = this.addMessage.bind(this);\n        let apndmsg = this.appendMessageContent.bind(this);\n        var addMsgCB = function (c, u, a) { return admsg(c, u, a) };\n        var apndMsgCB = function (id, c) { return apndmsg(id, c) }\n        let handleUserSubmit = () => {\n            // Submit the message\n            const content = inputTextarea.value.trim(); // Remove leading/trailing whitespace\n            if (content !== '') {\n                // if echo, write the user's content to the chat area\n                const user = this.userName;\n                if (this.echo)\n                    this.addMessage(content, user, this.userAlignment);\n                inputTextarea.value = ''; // Clear input field after sending\n                // Call the bot response completionCallback function, passing the user's input\n                this.completionCallback({ content, user }, addMsgCB, apndMsgCB);\n            }\n        }\n        inputTextarea.addEventListener('keydown', (event) => {\n            // Check if Shift + Enter is pressed\n            if (event.shiftKey && event.keyCode === 13) {\n                // Prevent default behavior (adding new line)\n                event.preventDefault();\n                handleUserSubmit();\n            }\n        });\n        this.submitButton.addEventListener('click', () => { handleUserSubmit() });\n\n        this.container.addEventListener('resize', ()=> {handleContainerResize()});\n        this.adjustMessagesAreaHeight();\n        this.adjustSendButtonWidth();\n        this.showTitleArea(false);\n    }\n    /**\n    Returns a portion of the message history.\n    @param {number} n - The starting index of the messages to retrieve. If negative, it will be counted from the end of the message history.\n    @param {number} m - Optional. The ending index of the messages to retrieve. If omitted, only the message at index n will be returned.\n    @returns {Array} An array of message objects, or an empty array if there are no messages or the indices are invalid.\n    */\n    getMessageHistory(n, m) {\n        if (this.messages.length <= 0)\n            return [];\n        if (typeof (n) != \"number\")\n            return [];\n        if (typeof (m) == \"number\") {\n            if (n < m)\n                return this.messages.slice(n, m);\n            else\n                return this.messages.slice(m, n);\n        }\n        else {\n            if (n < 0)\n                n = this.messages.length + n;\n            return [this.messages[n]]\n        }\n    }\n    /**\n    Returns statistics about the chat messages.\n    @returns {Object} An object containing the following statistics:\n    numMessages: The total number of messages in the chat.\n    numUsers: The number of unique users who have sent messages.\n    firstMsgTimestamp: The timestamp of the first message in the chat.\n    lastMsgTimestamp: The timestamp of the last message in the chat.\n    */\n    getMessageStats() {\n        let stats = {\n            \"numMessages\": this.messages.length,\n            // \"numUsers\": this.users.keys().length,\n            \"firstMsgTimestamp\": this.messages.length > 0 ? this.messages[0].timestamp : \"\",\n            \"lastMsgTimestamp\": this.messages.length > 0 ? this.messages[this.messages.length - 1].timestamp : \"\",\n        }\n        return stats;\n    }\n}"],"names":["yackbox","div","completionCallback","streamCallback","_classCallCheck","container","document","querySelector","HTMLElement","console","error","createElement","title","titleAlignment","userName","userAlignment","messages","echo","users","initUI","_createClass","key","value","addCompletionCallback","addStreamCallback","addUserMessage","content","addMessage","setDefaultUserName","user","arguments","length","undefined","alignment","userAlignement","setUserInputEcho","adjustMessagesAreaHeight","chatWidget","hiddenElements","_toConsumableArray","children","filter","child","classList","contains","totalHiddenHeight","reduce","sum","offsetHeight","containerHeight","messagesContainer","style","height","concat","handleContainerResize","adjustSendButtonWidth","submitButtonText","submitButton","textContent","trim","fontSize","parseFloat","getComputedStyle","minWidth","showInputArea","show","inputAreaBox","display","remove","add","showTitleArea","titleArea","id","timestamp","Date","toUTCString","message","push","lcr","userContent","messageContent","messageHTML","innerHTML","lastChild","scrollIntoView","updateMessageFull","side","find","msg","whichSide","lastUpdateTimestamp","messageDiv","appendMessageContent","removeMessage","messageIndex","findIndex","splice","parentNode","removeChild","removeMessageAll","_this","yackboxContainer","inputTextArea","inputTextarea","admsg","bind","apndmsg","addMsgCB","c","u","a","apndMsgCB","handleUserSubmit","addEventListener","event","shiftKey","keyCode","preventDefault","getMessageHistory","n","m","slice","getMessageStats","stats"],"mappings":"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"}