{"version":3,"file":"yackbox.cjs.js","sources":["../src/yackbox.js"],"sourcesContent":["export default class yackbox {\n    constructor(div, completionCallback, streamCallback) {\n\n        this.container = (typeof(div) == \"string\") ? document.querySelector(div) : (div instanceof HTMLElement) ? div : null;\n        if (!this.container) {\n            console.error(\"Invalid container element for yackbox, creating a new one.\");\n            this.container = document.createElement('div');\n        }\n        this.userName = \"You\";\n        this.userAlignment = \"left\";\n        this.completionCallback = (completionCallback) ? completionCallback : () => {};\n        this.streamCallback = (streamCallback) ? streamCallback : () => {};\n        this.messages = [];\n        this.echo = true; // echo user input\n        this.users = {}\n       // this.users = {}\n        this.initUI();\n    }\n\n    addCompletionCallback (completionCallback) {\n        this.completionCallback = (completionCallback) ? completionCallback : () => {};\n    }\n    addStreamCallback (streamCallback) {\n        this.streamCallback = (streamCallback) ? streamCallback : () => {};\n    }\n    \n    addUserMessage(content) {\n        this.addMessage(content, this.userName, this.userAlignment);\n    }\n    setDefaultUserName(user = \"You\", alignment = \"right\") {\n        this.userName = user;\n        this.userAlignement = alignment;\n    }\n    setUserInputEcho(echo) {\n        this.echo = (echo) ? true: false;\n        return this.echo;\n    }\n    showInputArea(show) {\n        if (show) {\n            this.inputAreaBox.style.display = \"\";\n             this.messagesContainer.style.height = \"88%;\"\n        }\n        else {\n            this.inputAreaBox.style.display = \"none\";\n            this.messagesContainer.style.height = \"98%\"\n        }\n    }\n    \n    // add a new message to the chat\n    addMessage(content, user, alignment = 'left') {\n        const id = this.messages.length;\n        const timestamp  = (new Date()).toUTCString();\n        const message = { id, user, content, alignment , timestamp};\n        this.messages.push(message);\n        const lcr = (alignment == \"left\" )? \"yackbox-left\" : (alignment == \"right\")? \"yackbox-right\" :  \"yackbox-center\";\n        const userContent = `<div class=\"yackbox-username ${lcr}\">${user}</div>`;\n        const messageContent = `<div class=\"yackbox-content ${lcr}\">${content}</div>`;\n        const messageHTML = \n            `<div id=\"yackbox-msg${id}\" class=\"yackbox-message ${lcr}\">${userContent}${messageContent}</div>` ;\n\n        \n        this.messagesContainer.innerHTML += messageHTML;\n        this.messagesContainer.lastChild.scrollIntoView()\n        return id;\n    }\n    // update all the fields of an existing message\n    updateMessageFull(id, content, user = null, side = null) {\n        const message = this.messages.find(msg => msg.id === id);\n        if (!message) return;\n        if (content) message.content = content;\n        if (user) message.user = user;\n        if (side) message.whichSide = side;\n        message.lastUpdateTimestamp = (new Date()).toUTCString();\n        const messageDiv = this.container.querySelector(`#msg-${id}`);\n        if (messageDiv) {\n            const userContent = `<div class=\"yackbox-username\">${message.user}</div>`;\n            const messageContent = `<div class=\"yackbox-content\">${message.content}</div>`;\n            messageDiv.innerHTML = \n                `${messageContent}${userContent}`;\n        }\n        return id;\n    }\n    \n    // append content to an existing message, useful for streaming\n    appendMessageContent(id, content) {\n        const message = this.messages.find(msg => msg.id === id);\n        if (!message) return;\n\n        if (content) \n            message.content += content;\n        \n        message.lastUpdateTimestamp = (new Date()).toUTCString();\n\n        const messageDiv = this.container.querySelector(`#yackbox-msg${id} .yackbox-content`);\n        if (messageDiv) {\n            messageDiv.innerHTML = message.content;\n            messageDiv.scrollIntoView(false);\n\n        }\n        return id;\n    }\n\n    // remove a single message\n    removeMessage(id) {\n        const messageIndex = this.messages.findIndex(msg => msg.id === id);\n        if (messageIndex > -1) {\n            this.messages.splice(messageIndex, 1);\n            const messageDiv = this.container.querySelector(`.yackbox-msg${id}`);\n            if (messageDiv) {\n                messageDiv.parentNode.removeChild(messageDiv);\n            }\n            return true;\n        }\n        return false; // didn't do anything\n    }\n\n    //remove all messages\n    removeMessageAll() {\n        this.messages=[]; \n    }\n    initUI() {\n        this.container.innerHTML = `\n            <div class=\"yackbox-container\">\n                <div class=\"yackbox-messages\"></div>\n                <div class=\"yackbox-input-area\">\n                    <textarea class=\"yackbox-input-textbox\" placeholder=\"Type here...\"></textarea>\n                    <div class=\"yackbox-sep\"></div>\n                    <button class=\"yackbox-submit\">Send</button>\n                </div>\n            </div>\n        `;\n\n        this.messagesContainer = this.container.querySelector('.yackbox-messages');\n        this.messagesContainer.scrollIntoView(false);\n\n        this.inputAreaBox = this.container.querySelector('.yackbox-input-area');\n        this.inputTextArea = this.container.querySelector('.yackbox-input-textbox');\n        this.submitButton = this.container.querySelector('.yackbox-submit');\n\n        // Add event listener to the chat input textarea\n        const inputTextarea = this.inputTextArea;\n\n        // memoize callback fn\n        let admsg   = this.addMessage.bind(this);\n        let apndmsg = this.appendMessageContent.bind(this);\n        var addMsgCB  = function (c,u,a){return admsg(c,u,a)};\n        var apndMsgCB = function (id,c){return apndmsg(id,c)}\n\n        let handleUserSubmit= () => {\n            // Submit the message\n            const content = inputTextarea.value.trim(); // Remove leading/trailing whitespace\n            if (content !== '') {\n                // if echo, write the user's content to the chat area\n                const user = this.userName;\n                if (this.echo)\n                    this.addMessage(content, user, this.userAlignment); \n                inputTextarea.value = ''; // Clear input field after sending\n\n                // Call the bot response completionCallback function, passing the user's input\n                this.completionCallback({content,user}, addMsgCB, apndMsgCB);\n        }}\n        inputTextarea.addEventListener('keydown',  (event) => {\n            // Check if Shift + Enter is pressed\n            if (event.shiftKey && event.keyCode === 13) {\n                // Prevent default behavior (adding new line)\n                event.preventDefault();\n                handleUserSubmit();\n            }\n        });\n\n        this.submitButton.addEventListener('click',  () => {handleUserSubmit() });\n    }\n    getMessageHistory(n,m) {\n        if (this.messages.length <=0)\n            return [];\n\n        if (typeof(n) != \"number\")\n            return [];\n\n        if (typeof(m) == \"number\" ) {\n            if (n < m)\n                return this.messages.slice(n,m);\n            else\n                return this.messages.slice(m,n);\n        }\n        else {\n            if (n<0)\n                n = this.messages.length+n;\n            return [this.messages[n]]\n        }\n    }\n    getMessageStats() {\n        let stats = {\n            \"numMessages\" : this.messages.length,\n            \"numUsers\" : this.user.keys().length,\n            \"firstMsgTimestamp\" : this.messages.length >0 ? this.messages[0].timestamp : \"\",\n            \"lastMsgTimestamp\"  : this.messages.length >0 ? this.messages[this.messages.length-1].timestamp : \"\",\n\n        }\n        \n        return stats;\n    }\n}\n"],"names":["yackbox","div","completionCallback","streamCallback","_classCallCheck","container","document","querySelector","HTMLElement","console","error","createElement","userName","userAlignment","messages","echo","users","initUI","_createClass","key","value","addCompletionCallback","addStreamCallback","addUserMessage","content","addMessage","setDefaultUserName","user","arguments","length","undefined","alignment","userAlignement","setUserInputEcho","showInputArea","show","inputAreaBox","style","display","messagesContainer","height","id","timestamp","Date","toUTCString","message","push","lcr","userContent","concat","messageContent","messageHTML","innerHTML","lastChild","scrollIntoView","updateMessageFull","side","find","msg","whichSide","lastUpdateTimestamp","messageDiv","appendMessageContent","removeMessage","messageIndex","findIndex","splice","parentNode","removeChild","removeMessageAll","_this","inputTextArea","submitButton","inputTextarea","admsg","bind","apndmsg","addMsgCB","c","u","a","apndMsgCB","handleUserSubmit","trim","addEventListener","event","shiftKey","keyCode","preventDefault","getMessageHistory","n","m","slice","getMessageStats","stats","keys"],"mappings":"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"}