!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).yackbox=t()}(this,(function(){"use strict";function e(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function t(t,n){for(var i=0;i<n.length;i++){var s=n[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,e(s.key),s)}}function n(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var s=function(){return e=function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container="string"==typeof t?document.querySelector(t):t instanceof HTMLElement?t:null,this.container||(console.error("Invalid container element for yackbox, creating a new element."),this.container=document.createElement("div")),this.title="Chat",this.titleAlignment="center",this.userName="You",this.userAlignment="left",this.completionCallback=n||function(){},this.streamCallback=i||function(){},this.messages=[],this.echo=!0,this.users={},this.initUI()},i=[{key:"addCompletionCallback",value:function(e){this.completionCallback=e||function(){}}},{key:"addStreamCallback",value:function(e){this.streamCallback=e||function(){}}},{key:"addUserMessage",value:function(e){this.addMessage(e,this.userName,this.userAlignment)}},{key:"setDefaultUserName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"You",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";this.userName=e,this.userAlignement=t}},{key:"setUserInputEcho",value:function(e){return this.echo=!!e,this.echo}},{key:"adjustMessagesAreaHeight",value:function(){var e=this.container,t=n(e.children).filter((function(e){return e.classList.contains("hidden")})).reduce((function(e,t){return e+t.offsetHeight}),0),i=e.offsetHeight;this.messagesContainer.style.height="calc(100% - ".concat(i-t,"px)")}},{key:"handleContainerResize",value:function(){adjustMessagesAreaHeight(),adjustSendButtonWidth()}},{key:"adjustSendButtonWidth",value:function(){var e=this.submitButton.textContent.trim(),t=parseFloat(getComputedStyle(this.submitButton).fontSize)*e.length+16;this.submitButton.style.minWidth="".concat(t,"px")}},{key:"showInputArea",value:function(e){e?(this.inputAreaBox.style.display="flex",this.inputAreaBox.classList.remove("hidden")):(this.inputAreaBox.style.display="none",this.inputAreaBox.classList.add("hidden")),this.adjustMessagesAreaHeight()}},{key:"showTitleArea",value:function(e){e?(this.titleArea.style.display="flex",this.titleArea.classList.remove("hidden")):(this.titleArea.style.display="none",this.titleArea.classList.add("hidden")),this.adjustMessagesAreaHeight()}},{key:"addMessage",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left",i=this.messages.length,s={id:i,user:t,content:e,alignment:n,timestamp:(new Date).toUTCString()};this.messages.push(s);var a="left"==n?"yackbox-left":"right"==n?"yackbox-right":"yackbox-center",r='<div class="yackbox-username '.concat(a,'">').concat(t,"</div>"),o='<div class="yackbox-content '.concat(a,'">').concat(e,"</div>"),c='<div id="yackbox-msg-'.concat(i,'" class="yackbox-message ').concat(a,'">').concat(r).concat(o,"</div>");return this.messagesContainer.innerHTML+=c,this.messagesContainer.lastChild.scrollIntoView(),i}},{key:"updateMessageFull",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=this.messages.find((function(t){return t.id===e}));if(s){t&&(s.content=t),n&&(s.user=n),i&&(s.whichSide=i),s.lastUpdateTimestamp=(new Date).toUTCString();var a=this.container.querySelector("#msg - ${id}");if(a){var r='<div class="yackbox-username">'.concat(s.user,"</div>"),o='<div class="yackbox-content">'.concat(s.content,"</div>");a.innerHTML="".concat(o).concat(r)}return e}}},{key:"appendMessageContent",value:function(e,t){var n=this.messages.find((function(t){return t.id===e}));if(n){t&&(n.content+=t),n.lastUpdateTimestamp=(new Date).toUTCString();var i=this.container.querySelector("#yackbox-msg-".concat(e," .yackbox-content"));return i&&(i.innerHTML=n.content,i.scrollIntoView(!1)),e}}},{key:"removeMessage",value:function(e){var t=this.messages.findIndex((function(t){return t.id===e}));if(t>-1){this.messages.splice(t,1);var n=this.container.querySelector(".yackbox-msg${id}");return n&&n.parentNode.removeChild(n),!0}return!1}},{key:"removeMessageAll",value:function(){this.messages=[]}},{key:"initUI",value:function(){var e=this;this.container.innerHTML='<div class="yackbox-base yackbox-theme-light"> \n            <div class="yackbox-title-area"></div>\n            <div class="yackbox-messages-area"></div> \n            <div class="yackbox-input-area"> \n                <textarea class="yackbox-input-textbox" placeholder="Type here..."></textarea> \n                <button class="yackbox-input-send-btn">Send</button>\n            </div>\n        </div>',this.yackboxContainer=this.container.querySelector(".yackbox-base"),this.titleArea=this.container.querySelector(".yackbox-title-area"),this.titleArea.innerHTML="<h3>"+this.title+"</h3>",this.messagesContainer=this.container.querySelector(".yackbox-messages-area"),this.messagesContainer.scrollIntoView(!1),this.inputAreaBox=this.container.querySelector(".yackbox-input-area"),this.inputTextArea=this.container.querySelector(".yackbox-input-textbox"),this.submitButton=this.container.querySelector(".yackbox-input-send-btn");var t=this.inputTextArea,n=this.addMessage.bind(this),i=this.appendMessageContent.bind(this),s=function(e,t,i){return n(e,t,i)},a=function(e,t){return i(e,t)},r=function(){var n=t.value.trim();if(""!==n){var i=e.userName;e.echo&&e.addMessage(n,i,e.userAlignment),t.value="",e.completionCallback({content:n,user:i},s,a)}};t.addEventListener("keydown",(function(e){e.shiftKey&&13===e.keyCode&&(e.preventDefault(),r())})),this.submitButton.addEventListener("click",(function(){r()})),this.container.addEventListener("resize",(function(){handleContainerResize()})),this.adjustMessagesAreaHeight(),this.adjustSendButtonWidth(),this.showTitleArea(!1)}},{key:"getMessageHistory",value:function(e,t){return this.messages.length<=0||"number"!=typeof e?[]:"number"==typeof t?e<t?this.messages.slice(e,t):this.messages.slice(t,e):(e<0&&(e=this.messages.length+e),[this.messages[e]])}},{key:"getMessageStats",value:function(){return{numMessages:this.messages.length,firstMsgTimestamp:this.messages.length>0?this.messages[0].timestamp:"",lastMsgTimestamp:this.messages.length>0?this.messages[this.messages.length-1].timestamp:""}}}],i&&t(e.prototype,i),s&&t(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,i,s}();return s}));
//# sourceMappingURL=yackbox.umd.min.js.map
