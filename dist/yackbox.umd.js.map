{"version":3,"file":"yackbox.umd.js","sources":["../src/yackbox.js"],"sourcesContent":["export default class yackbox {\n    constructor(div, completionCallback, streamCallback) {\n\n        this.container = (typeof(div) == \"string\") ? document.querySelector(div) : (div instanceof HTMLElement) ? div : null;\n        if (!this.container) {\n            console.error(\"Invalid container element for yackbox, creating a new one.\");\n            this.container = document.createElement('div');\n        }\n        this.userName = \"You\";\n        this.userAlignment = \"left\";\n        this.completionCallback = (completionCallback) ? completionCallback : () => {};\n        this.streamCallback = (streamCallback) ? streamCallback : () => {};\n        this.messages = [];\n        this.echo = true; // echo user input\n        this.users = {}\n       // this.users = {}\n        this.initUI();\n    }\n\n    addCompletionCallback (completionCallback) {\n        this.completionCallback = (completionCallback) ? completionCallback : () => {};\n    }\n    addStreamCallback (streamCallback) {\n        this.streamCallback = (streamCallback) ? streamCallback : () => {};\n    }\n    \n    addUserMessage(content) {\n        this.addMessage(content, this.userName, this.userAlignment);\n    }\n    setDefaultUserName(user = \"You\", alignment = \"right\") {\n        this.userName = user;\n        this.userAlignement = alignment;\n    }\n    setUserInputEcho(echo) {\n        this.echo = (echo) ? true: false;\n        return this.echo;\n    }\n    showInputArea(show) {\n        if (show) {\n            this.inputAreaBox.style.display = \"\";\n             this.messagesContainer.style.height = \"88%;\"\n        }\n        else {\n            this.inputAreaBox.style.display = \"none\";\n            this.messagesContainer.style.height = \"98%\"\n        }\n    }\n    \n    // add a new message to the chat\n    addMessage(content, user, alignment = 'left') {\n        const id = this.messages.length;\n        const timestamp  = (new Date()).toUTCString();\n        const message = { id, user, content, alignment , timestamp};\n        this.messages.push(message);\n        const lcr = (alignment == \"left\" )? \"yackbox-left\" : (alignment == \"right\")? \"yackbox-right\" :  \"yackbox-center\";\n        const userContent = `<div class=\"yackbox-username ${lcr}\">${user}</div>`;\n        const messageContent = `<div class=\"yackbox-content ${lcr}\">${content}</div>`;\n        const messageHTML = \n            `<div id=\"yackbox-msg${id}\" class=\"yackbox-message ${lcr}\">${userContent}${messageContent}</div>` ;\n\n        \n        this.messagesContainer.innerHTML += messageHTML;\n        this.messagesContainer.lastChild.scrollIntoView()\n        return id;\n    }\n    // update all the fields of an existing message\n    updateMessageFull(id, content, user = null, side = null) {\n        const message = this.messages.find(msg => msg.id === id);\n        if (!message) return;\n        if (content) message.content = content;\n        if (user) message.user = user;\n        if (side) message.whichSide = side;\n        message.lastUpdateTimestamp = (new Date()).toUTCString();\n        const messageDiv = this.container.querySelector(`#msg-${id}`);\n        if (messageDiv) {\n            const userContent = `<div class=\"yackbox-username\">${message.user}</div>`;\n            const messageContent = `<div class=\"yackbox-content\">${message.content}</div>`;\n            messageDiv.innerHTML = \n                `${messageContent}${userContent}`;\n        }\n        return id;\n    }\n    \n    // append content to an existing message, useful for streaming\n    appendMessageContent(id, content) {\n        const message = this.messages.find(msg => msg.id === id);\n        if (!message) return;\n\n        if (content) \n            message.content += content;\n        \n        message.lastUpdateTimestamp = (new Date()).toUTCString();\n\n        const messageDiv = this.container.querySelector(`#yackbox-msg${id} .yackbox-content`);\n        if (messageDiv) {\n            messageDiv.innerHTML = message.content;\n            messageDiv.scrollIntoView(false);\n\n        }\n        return id;\n    }\n\n    // remove a single message\n    removeMessage(id) {\n        const messageIndex = this.messages.findIndex(msg => msg.id === id);\n        if (messageIndex > -1) {\n            this.messages.splice(messageIndex, 1);\n            const messageDiv = this.container.querySelector(`.yackbox-msg${id}`);\n            if (messageDiv) {\n                messageDiv.parentNode.removeChild(messageDiv);\n            }\n            return true;\n        }\n        return false; // didn't do anything\n    }\n\n    //remove all messages\n    removeMessageAll() {\n        this.messages=[]; \n    }\n    initUI() {\n        this.container.innerHTML = `\n            <div class=\"yackbox-container\">\n                <div class=\"yackbox-messages\"></div>\n                <div class=\"yackbox-input-area\">\n                    <textarea class=\"yackbox-input-textbox\" placeholder=\"Type here...\"></textarea>\n                    <div class=\"yackbox-sep\"></div>\n                    <button class=\"yackbox-submit\">Send</button>\n                </div>\n            </div>\n        `;\n\n        this.messagesContainer = this.container.querySelector('.yackbox-messages');\n        this.messagesContainer.scrollIntoView(false);\n\n        this.inputAreaBox = this.container.querySelector('.yackbox-input-area');\n        this.inputTextArea = this.container.querySelector('.yackbox-input-textbox');\n        this.submitButton = this.container.querySelector('.yackbox-submit');\n\n        // Add event listener to the chat input textarea\n        const inputTextarea = this.inputTextArea;\n\n        // memoize callback fn\n        let admsg   = this.addMessage.bind(this);\n        let apndmsg = this.appendMessageContent.bind(this);\n        var addMsgCB  = function (c,u,a){return admsg(c,u,a)};\n        var apndMsgCB = function (id,c){return apndmsg(id,c)}\n\n        let handleUserSubmit= () => {\n            // Submit the message\n            const content = inputTextarea.value.trim(); // Remove leading/trailing whitespace\n            if (content !== '') {\n                // if echo, write the user's content to the chat area\n                const user = this.userName;\n                if (this.echo)\n                    this.addMessage(content, user, this.userAlignment); \n                inputTextarea.value = ''; // Clear input field after sending\n\n                // Call the bot response completionCallback function, passing the user's input\n                this.completionCallback({content,user}, addMsgCB, apndMsgCB);\n        }}\n        inputTextarea.addEventListener('keydown',  (event) => {\n            // Check if Shift + Enter is pressed\n            if (event.shiftKey && event.keyCode === 13) {\n                // Prevent default behavior (adding new line)\n                event.preventDefault();\n                handleUserSubmit();\n            }\n        });\n\n        this.submitButton.addEventListener('click',  () => {handleUserSubmit() });\n    }\n    getMessageHistory(n,m) {\n        if (this.messages.length <=0)\n            return [];\n\n        if (typeof(n) != \"number\")\n            return [];\n\n        if (typeof(m) == \"number\" ) {\n            if (n < m)\n                return this.messages.slice(n,m);\n            else\n                return this.messages.slice(m,n);\n        }\n        else {\n            if (n<0)\n                n = this.messages.length+n;\n            return [this.messages[n]]\n        }\n    }\n    getMessageStats() {\n        let stats = {\n            \"numMessages\" : this.messages.length,\n            \"numUsers\" : this.user.keys().length,\n            \"firstMsgTimestamp\" : this.messages.length >0 ? this.messages[0].timestamp : \"\",\n            \"lastMsgTimestamp\"  : this.messages.length >0 ? this.messages[this.messages.length-1].timestamp : \"\",\n\n        }\n        \n        return stats;\n    }\n}\n"],"names":["yackbox","div","completionCallback","streamCallback","_classCallCheck","container","document","querySelector","HTMLElement","console","error","createElement","userName","userAlignment","messages","echo","users","initUI","_createClass","key","value","addCompletionCallback","addStreamCallback","addUserMessage","content","addMessage","setDefaultUserName","user","arguments","length","undefined","alignment","userAlignement","setUserInputEcho","showInputArea","show","inputAreaBox","style","display","messagesContainer","height","id","timestamp","Date","toUTCString","message","push","lcr","userContent","concat","messageContent","messageHTML","innerHTML","lastChild","scrollIntoView","updateMessageFull","side","find","msg","whichSide","lastUpdateTimestamp","messageDiv","appendMessageContent","removeMessage","messageIndex","findIndex","splice","parentNode","removeChild","removeMessageAll","_this","inputTextArea","submitButton","inputTextarea","admsg","bind","apndmsg","addMsgCB","c","u","a","apndMsgCB","handleUserSubmit","trim","addEventListener","event","shiftKey","keyCode","preventDefault","getMessageHistory","n","m","slice","getMessageStats","stats","keys"],"mappings":"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"}